---
name: reporting-feedback
description: Use when a sub-agent needs to open a PR with skill improvement suggestions based on user feedback
---

# Reporting Feedback

<!-- Test change for version bump automation -->

Open a PR in the wlr-cc-plugins repo suggesting changes to a skill based on user feedback from a skill execution session.

## Input Expected

The spawning agent should provide:
- **Skill identifier** - The full skill name (e.g., `opinionated-setup:setup-python-project`)
- **Feedback summary** - What preferences or corrections were identified
- **Conversation context** - Relevant excerpt showing the user's corrections and reasoning

## Process

### 1. Parse the Skill Path

Convert the skill identifier to a file path:
- `{plugin}:{skill}` becomes `{plugin}/skills/{skill}/SKILL.md`
- Example: `opinionated-setup:setup-python-project` becomes `opinionated-setup/skills/setup-python-project/SKILL.md`

### 2. Fetch Current Skill Content

```bash
SKILL_PATH="{plugin}/skills/{skill}/SKILL.md"
gh api "repos/wlritchi/wlr-cc-plugins/contents/$SKILL_PATH" \
  --jq '.content' | base64 -d > /tmp/skill-edit.md
```

### 3. Read and Analyze

Use the Read tool to examine `/tmp/skill-edit.md` and understand:
- Current structure and sections
- Where the feedback-related changes should go
- What specific modifications address the user's preferences

### 4. Clarifications

If the feedback is ambiguous or you're unsure how to translate it into a skill change, use AskUserQuestion to clarify with the user. Examples:
- "The feedback mentions 'stricter typing' - should I enable all strict flags, or just specific ones?"
- "Should this be the new default, or offered as an option during the skill's prompts?"

Don't guess on ambiguous changes - a clarifying question is better than a wrong PR.

### 5. Make Targeted Edits

Use the Edit tool to make precise, minimal changes to `/tmp/skill-edit.md`. Prefer targeted edits over whole-file rewrites to produce clean diffs.

### 6. Create a Branch

```bash
# Get main branch SHA
MAIN_SHA=$(gh api repos/wlritchi/wlr-cc-plugins/git/refs/heads/main --jq '.object.sha')

# Create branch with descriptive name
BRANCH_NAME="feedback/{plugin}-{short-description}"
gh api repos/wlritchi/wlr-cc-plugins/git/refs \
  -f ref="refs/heads/$BRANCH_NAME" \
  -f sha="$MAIN_SHA"
```

Use a short, descriptive branch name based on the feedback topic (e.g., `feedback/opinionated-setup-strict-typing`).

### 7. Commit the Changes

```bash
# Get current file SHA (needed for update)
FILE_SHA=$(gh api "repos/wlritchi/wlr-cc-plugins/contents/$SKILL_PATH" \
  --jq '.sha')

# Commit the edited file
gh api "repos/wlritchi/wlr-cc-plugins/contents/$SKILL_PATH" \
  -X PUT \
  -f message="feat({plugin}): {short description}" \
  -f content="$(base64 -w 0 < /tmp/skill-edit.md)" \
  -f sha="$FILE_SHA" \
  -f branch="$BRANCH_NAME"
```

### 8. Open the PR

```bash
gh pr create --repo wlritchi/wlr-cc-plugins \
  --head "$BRANCH_NAME" \
  --title "feat({plugin}): {short description}" \
  --body "$(cat <<'EOF'
## Feedback Source

Skill: `{skill-identifier}`

## Summary

{feedback summary - what preference or correction was identified}

## Context

{relevant conversation excerpt showing the user's corrections}

## Changes Made

{description of what was changed in the skill and why}

---
Generated by skill-feedback:reporting-feedback
EOF
)"
```

### 9. Clean Up and Report

```bash
rm /tmp/skill-edit.md
```

Return the PR number and URL to the spawning agent so it can report to the user.

## Meta-Feedback

If you encountered issues executing this skill (unclear instructions, API errors, missing context), include those improvements in the same PR you're already creating:
- Add a separate commit for changes to this skill's file (`skill-feedback/skills/reporting-feedback/SKILL.md`)
- Or note the issue in the PR description if the fix isn't obvious

This avoids spawning another sub-agent and losing context about what went wrong.
